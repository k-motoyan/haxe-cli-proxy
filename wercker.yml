box: ruby
build:
  steps:
    - bundle-install
    - script:
      name: install packages
      code: |
        sudo apt-get update
        sudo apt-get -y install ocaml ocaml-native-compilers camlp4-extra opam
    - script:
      name: install haxe
      code: |
        if [ ! -e $WERCKER_CACHE_DIR/bin ]; then
          mkdir $WERCKER_CACHE_DIR/bin
        fi

        if [ ! -e $WERCKER_CACHE_DIR/haxe ]; then
          git clone --recursive https://github.com/HaxeFoundation/haxe.git -b 3.2.0 $WERCKER_CACHE_DIR/haxe
          cd $WERCKER_CACHE_DIR/haxe && make && make install
          mv /usr/bin/haxe $WERCKER_CACHE_DIR/bin/haxe
          mv /usr/bin/haxelib $WERCKER_CACHE_DIR/bin/haxelib
        fi

        ls -al
    - script:
      name: rspec
      code: |
        export PATH=$WERCKER_CACHE_DIR/bin:$PATH
        which haxe
        haxe --help
        bundle exec rspec
